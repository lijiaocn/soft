<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>连接/协议栈状态</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <div style="width:100%;text-align:center">
                  <h2 style="color:#afa790">小鸟笔记-系统软件</h2>
                  <p style="font-weight:bold"><a style="color:lightgray;" href="https://www.lijiaocn.com">www.lijiaocn.com</a></p>
                </div>
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> 小鸟笔记—软件篇</a></li><li class="chapter-item expanded "><a href="../tools/index.html"><strong aria-hidden="true">2.</strong> 常用工具</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tools/domainip.html"><strong aria-hidden="true">2.1.</strong> 域名和IP相关</a></li><li class="chapter-item expanded "><a href="../tools/http.html"><strong aria-hidden="true">2.2.</strong> HTTP协议相关</a></li><li class="chapter-item expanded "><a href="../tools/benchmark.html"><strong aria-hidden="true">2.3.</strong> 性能测试相关</a></li></ol></li><li class="chapter-item expanded "><a href="../linuxsys/index.html"><strong aria-hidden="true">3.</strong> Linux 系统手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linuxsys/linux-net-device-brief.html"><strong aria-hidden="true">3.1.</strong> 网络设备</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linuxsys/linux-net-device-iproute2.html"><strong aria-hidden="true">3.1.1.</strong> iproute2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linuxsys/linux-net-device-ip-link.html"><strong aria-hidden="true">3.1.1.1.</strong> ip-link</a></li></ol></li><li class="chapter-item expanded "><a href="../linuxsys/iptables.html"><strong aria-hidden="true">3.1.2.</strong> iptables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linuxsys/iptables-match.html"><strong aria-hidden="true">3.1.2.1.</strong> 报文匹配规则</a></li><li class="chapter-item expanded "><a href="../linuxsys/iptables-target.html"><strong aria-hidden="true">3.1.2.2.</strong> 报文处理动作</a></li></ol></li><li class="chapter-item expanded "><a href="../linuxsys/localip.html"><strong aria-hidden="true">3.1.3.</strong> local</a></li><li class="chapter-item expanded "><a href="../linuxsys/tpproxy.html"><strong aria-hidden="true">3.1.4.</strong> 透明代理</a></li></ol></li><li class="chapter-item expanded "><a href="../linuxsys/resource.html"><strong aria-hidden="true">3.2.</strong> 资源管理</a></li></ol></li><li class="chapter-item expanded "><a href="../k8s/index.html"><strong aria-hidden="true">4.</strong> Kubernetes 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../minikube/index.html"><strong aria-hidden="true">4.1.</strong> minikube 本地部署</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../minikube/install.html"><strong aria-hidden="true">4.1.1.</strong> 安装 minikube</a></li><li class="chapter-item expanded "><a href="../minikube/deploy.html"><strong aria-hidden="true">4.1.2.</strong> 启动 kubernetes</a></li><li class="chapter-item expanded "><a href="../minikube/vm.html"><strong aria-hidden="true">4.1.3.</strong> 进入 minikube</a></li><li class="chapter-item expanded "><a href="../minikube/config.html"><strong aria-hidden="true">4.1.4.</strong> 修改 kubernetes</a></li><li class="chapter-item expanded "><a href="../minikube/oper.html"><strong aria-hidden="true">4.1.5.</strong> 操作 kubernetes</a></li><li class="chapter-item expanded "><a href="../minikube/request.html"><strong aria-hidden="true">4.1.6.</strong> 访问 kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="../k8s/res.html"><strong aria-hidden="true">4.2.</strong> k8s API 定义列表</a></li><li class="chapter-item expanded "><a href="../k8s/code.html"><strong aria-hidden="true">4.3.</strong> k8s 源码阅读指引</a></li><li class="chapter-item expanded "><a href="../k8s/svc/external.html"><strong aria-hidden="true">4.4.</strong> k8s 导入外部服务</a></li><li class="chapter-item expanded "><a href="../k8s/usage/pod.html"><strong aria-hidden="true">4.5.</strong> k8s 操作技巧收集</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/index.html"><strong aria-hidden="true">4.6.</strong> ingress-nginx 用法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/tls.html"><strong aria-hidden="true">4.6.1.</strong> 传输加密</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/auth.html"><strong aria-hidden="true">4.6.2.</strong> 自带认证</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/auth-ext.html"><strong aria-hidden="true">4.6.3.</strong> 外部认证</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/rewrite.html"><strong aria-hidden="true">4.6.4.</strong> 请求改写</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/mirror.html"><strong aria-hidden="true">4.6.5.</strong> 请求复制</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/ratelimit.html"><strong aria-hidden="true">4.6.6.</strong> 源IP限速</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/canary.html"><strong aria-hidden="true">4.6.7.</strong> 金丝雀发布</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/anno.html"><strong aria-hidden="true">4.6.8.</strong> 常用注解</a></li><li class="chapter-item expanded "><a href="../k8s/ingress-nginx/note.html"><strong aria-hidden="true">4.6.9.</strong> 相关笔记</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../istio/index.html"><strong aria-hidden="true">5.</strong> Istio 服务网格</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../istio/install.html"><strong aria-hidden="true">5.1.</strong> 部署环境准备</a></li><li class="chapter-item expanded "><a href="../istio/demo-install.html"><strong aria-hidden="true">5.2.</strong> 预览版部署</a></li><li class="chapter-item expanded "><a href="../istio/command.html"><strong aria-hidden="true">5.3.</strong> 操作命令</a></li><li class="chapter-item expanded "><a href="../istio/config.html"><strong aria-hidden="true">5.4.</strong> 配置参数</a></li><li class="chapter-item expanded "><a href="../istio/concept.html"><strong aria-hidden="true">5.5.</strong> 功能概念</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../istio/vsvc.html"><strong aria-hidden="true">5.5.1.</strong> VirtualService</a></li><li class="chapter-item expanded "><a href="../istio/dstrule.html"><strong aria-hidden="true">5.5.2.</strong> DestinationRule</a></li><li class="chapter-item expanded "><a href="../istio/gateway.html"><strong aria-hidden="true">5.5.3.</strong> Gateway</a></li><li class="chapter-item expanded "><a href="../istio/entry.html"><strong aria-hidden="true">5.5.4.</strong> ServiceEntry</a></li><li class="chapter-item expanded "><a href="../istio/egress.html"><strong aria-hidden="true">5.5.5.</strong> Engress Control</a></li></ol></li><li class="chapter-item expanded "><a href="../istio/sample.html"><strong aria-hidden="true">5.6.</strong> istio 示例拆解</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../istio/httprecord.html"><strong aria-hidden="true">5.6.1.</strong> Http-Record Application</a></li><li class="chapter-item expanded "><a href="../istio/bookinfo.html"><strong aria-hidden="true">5.6.2.</strong> Bookinfo Application</a></li></ol></li><li class="chapter-item expanded "><a href="../istio/route.html"><strong aria-hidden="true">5.7.</strong> 转发路由</a></li><li class="chapter-item expanded "><a href="../istio/shift.html"><strong aria-hidden="true">5.8.</strong> 流量切换</a></li><li class="chapter-item expanded "><a href="../istio/injection.html"><strong aria-hidden="true">5.9.</strong> 错误注入</a></li><li class="chapter-item expanded "><a href="../istio/timeout.html"><strong aria-hidden="true">5.10.</strong> 超时设置</a></li><li class="chapter-item expanded "><a href="../istio/tpolicy.html"><strong aria-hidden="true">5.11.</strong> 负载均衡</a></li><li class="chapter-item expanded "><a href="../istio/mirror.html"><strong aria-hidden="true">5.12.</strong> 流量复制</a></li><li class="chapter-item expanded "><a href="../istio/tracing.html"><strong aria-hidden="true">5.13.</strong> 链路跟踪</a></li><li class="chapter-item expanded "><a href="../istio/metrics.html"><strong aria-hidden="true">5.14.</strong> 指标采集</a></li><li class="chapter-item expanded "><a href="../istio/log.html"><strong aria-hidden="true">5.15.</strong> 日志收集</a></li><li class="chapter-item expanded "><a href="../istio/policy.html"><strong aria-hidden="true">5.16.</strong> 访问控制</a></li><li class="chapter-item expanded "><a href="../istio/modify.html"><strong aria-hidden="true">5.17.</strong> 请求改写</a></li></ol></li><li class="chapter-item expanded "><a href="../envoy/index.html"><strong aria-hidden="true">6.</strong> Envoy 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../envoy/install.html"><strong aria-hidden="true">6.1.</strong> 安装运行</a></li><li class="chapter-item expanded "><a href="../envoy/echoserver.html"><strong aria-hidden="true">6.2.</strong> 初次体验</a></li><li class="chapter-item expanded "><a href="../envoy/config.html"><strong aria-hidden="true">6.3.</strong> 配置文件</a></li><li class="chapter-item expanded "><a href="../envoy/config-static.html"><strong aria-hidden="true">6.4.</strong> 静态配置</a></li><li class="chapter-item expanded "><a href="../envoy/config-dynamic.html"><strong aria-hidden="true">6.5.</strong> 动态配置</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../envoy/xds.html"><strong aria-hidden="true">6.5.1.</strong> 用 XDS 下发配置</a></li><li class="chapter-item expanded "><a href="../envoy/ads.html"><strong aria-hidden="true">6.5.2.</strong> 用 ADS 下发配置</a></li><li class="chapter-item expanded "><a href="../envoy/mds.html"><strong aria-hidden="true">6.5.3.</strong> lds/cds/rds/sds/eds</a></li></ol></li><li class="chapter-item expanded "><a href="../envoy/control.html"><strong aria-hidden="true">6.6.</strong> 控制平面实现</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../envoy/go-control-plane-api.html"><strong aria-hidden="true">6.6.1.</strong> go-control-plane 配置定义</a></li><li class="chapter-item expanded "><a href="../envoy/go-control-plane-send.html"><strong aria-hidden="true">6.6.2.</strong> go-control-plane 使用介绍</a></li><li class="chapter-item expanded "><a href="../envoy/go-control-plane-env.html"><strong aria-hidden="true">6.6.3.</strong> go-control-plane 示例准备</a></li><li class="chapter-item expanded "><a href="../envoy/go-control-plane-code.html"><strong aria-hidden="true">6.6.4.</strong> go-control-plane 示例说明</a></li><li class="chapter-item expanded "><a href="../envoy/go-control-plane-run.html"><strong aria-hidden="true">6.6.5.</strong> go-control-plane 示例运行</a></li></ol></li><li class="chapter-item expanded "><a href="../envoy/cluster.html"><strong aria-hidden="true">6.7.</strong> Cluster 详解</a></li><li class="chapter-item expanded "><a href="../envoy/listener.html"><strong aria-hidden="true">6.8.</strong> Listener 详解</a></li><li class="chapter-item expanded "><a href="../envoy/filter.html"><strong aria-hidden="true">6.9.</strong> Filter 详解</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../envoy/filter-def.html"><strong aria-hidden="true">6.9.1.</strong> filter 的定义与下发</a></li><li class="chapter-item expanded "><a href="../envoy/listener-filter.html"><strong aria-hidden="true">6.9.2.</strong> listener filter</a></li><li class="chapter-item expanded "><a href="../envoy/network-filter.html"><strong aria-hidden="true">6.9.3.</strong> network filter</a></li><li class="chapter-item expanded "><a href="../envoy/http-filter.html"><strong aria-hidden="true">6.9.4.</strong> http filter</a></li></ol></li><li class="chapter-item expanded "><a href="../envoy/l4.html"><strong aria-hidden="true">6.10.</strong> 4 层 TCP/UDP 转发</a></li><li class="chapter-item expanded "><a href="../envoy/qa.html"><strong aria-hidden="true">6.11.</strong> 常见问题</a></li></ol></li><li class="chapter-item expanded "><a href="../nginx/index.html"><strong aria-hidden="true">7.</strong> Nginx 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../nginx/env.html"><strong aria-hidden="true">7.1.</strong> nginx 试验环境</a></li><li class="chapter-item expanded "><a href="../nginx/config.html"><strong aria-hidden="true">7.2.</strong> nginx 配置文件</a></li><li class="chapter-item expanded "><a href="../nginx/comm.html"><strong aria-hidden="true">7.3.</strong> nginx 常用配置</a></li><li class="chapter-item expanded "><a href="../nginx/performance.html"><strong aria-hidden="true">7.4.</strong> nginx 性能参数</a></li><li class="chapter-item expanded "><a href="../nginx/important.html"><strong aria-hidden="true">7.5.</strong> nginx 注意事项</a></li><li class="chapter-item expanded "><a href="../nginx/status.html"><strong aria-hidden="true">7.6.</strong> nginx 状态数据</a></li><li class="chapter-item expanded "><a href="../nginx/mirror.html"><strong aria-hidden="true">7.7.</strong> nginx 请求复制</a></li><li class="chapter-item expanded "><a href="../nginx/abtest.html"><strong aria-hidden="true">7.8.</strong> nginx A/B 测试</a></li><li class="chapter-item expanded "><a href="../nginx/proxy.html"><strong aria-hidden="true">7.9.</strong> nginx 透明代理</a></li></ol></li><li class="chapter-item expanded "><a href="../openresty/index.html"><strong aria-hidden="true">8.</strong> OpenResty 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../openresty/env.html"><strong aria-hidden="true">8.1.</strong> openresty 环境准备</a></li><li class="chapter-item expanded "><a href="../openresty/lua.html"><strong aria-hidden="true">8.2.</strong> openresty lua 交互</a></li><li class="chapter-item expanded "><a href="../openresty/common.html"><strong aria-hidden="true">8.3.</strong> openresty 常规操作</a></li></ol></li><li class="chapter-item expanded "><a href="../prometheus/index.html"><strong aria-hidden="true">9.</strong> Prometheus 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../prometheus/start.html"><strong aria-hidden="true">9.1.</strong> 安装配置</a></li><li class="chapter-item expanded "><a href="../prometheus/types.html"><strong aria-hidden="true">9.2.</strong> 数据类型</a></li><li class="chapter-item expanded "><a href="../prometheus/query.html"><strong aria-hidden="true">9.3.</strong> 查询语法</a></li><li class="chapter-item expanded "><a href="../prometheus/query-compute.html"><strong aria-hidden="true">9.4.</strong> 数值运算</a></li><li class="chapter-item expanded "><a href="../prometheus/query-function.html"><strong aria-hidden="true">9.5.</strong> 查询函数</a></li><li class="chapter-item expanded "><a href="../prometheus/exporters.html"><strong aria-hidden="true">9.6.</strong> 各种 exporter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../prometheus/blackbox.html"><strong aria-hidden="true">9.6.1.</strong> blackbox exporter</a></li></ol></li><li class="chapter-item expanded "><a href="../prometheus/pushgateway.html"><strong aria-hidden="true">9.7.</strong> pushgateway</a></li><li class="chapter-item expanded "><a href="../prometheus/more.html"><strong aria-hidden="true">9.8.</strong> 进阶拓展</a></li></ol></li><li class="chapter-item expanded "><a href="../ansible/index.html"><strong aria-hidden="true">10.</strong> Ansible 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ansible/privilege.html"><strong aria-hidden="true">10.1.</strong> 用户权限提升</a></li><li class="chapter-item expanded "><a href="../ansible/file.html"><strong aria-hidden="true">10.2.</strong> 文件和url处理</a></li><li class="chapter-item expanded "><a href="../ansible/install.html"><strong aria-hidden="true">10.3.</strong> 软件安装</a></li><li class="chapter-item expanded "><a href="../ansible/docker.html"><strong aria-hidden="true">10.4.</strong> 操作 docker</a></li></ol></li><li class="chapter-item expanded "><a href="../perf/index.html"><strong aria-hidden="true">11.</strong> Perf 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../perf/basic.html"><strong aria-hidden="true">11.1.</strong> perf 技术原理</a></li><li class="chapter-item expanded "><a href="../perf/usage1.html"><strong aria-hidden="true">11.2.</strong> perf 基本用法</a></li><li class="chapter-item expanded "><a href="../perf/pmu.html"><strong aria-hidden="true">11.3.</strong> PMU 事件</a></li></ol></li><li class="chapter-item expanded "><a href="../docker/index.html"><strong aria-hidden="true">12.</strong> Docker 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../docker/install.html"><strong aria-hidden="true">12.1.</strong> 安装配置</a></li><li class="chapter-item expanded "><a href="../docker/container.html"><strong aria-hidden="true">12.2.</strong> 容器操作</a></li><li class="chapter-item expanded "><a href="../docker/image.html"><strong aria-hidden="true">12.3.</strong> 镜像管理</a></li><li class="chapter-item expanded "><a href="../docker/principle.html"><strong aria-hidden="true">12.4.</strong> 原理进阶</a></li><li class="chapter-item expanded "><a href="../docker/compose/index.html"><strong aria-hidden="true">12.5.</strong> docker-compose</a></li><li class="chapter-item expanded "><a href="../docker/compose/mysql.html"><strong aria-hidden="true">12.6.</strong> MySQL镜像使用</a></li></ol></li><li class="chapter-item expanded "><a href="../git/index.html"><strong aria-hidden="true">13.</strong> Git 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../git/rebase.html"><strong aria-hidden="true">13.1.</strong> 提交准备 rebase</a></li><li class="chapter-item expanded "><a href="../git/repo-cross.html"><strong aria-hidden="true">13.2.</strong> 跨越多个 repo</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/index.html"><strong aria-hidden="true">14.</strong> 性能优化与问题诊断</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/01-concept.html"><strong aria-hidden="true">14.1.</strong> 认知框架</a></li><li class="chapter-item expanded "><a href="../linux/kernel.html"><strong aria-hidden="true">14.2.</strong> 理解内核</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/dynamic-trace.html"><strong aria-hidden="true">14.2.1.</strong> 动态追踪</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/03-cpu.html"><strong aria-hidden="true">14.3.</strong> 理解 CPU</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/02-process-3.html"><strong aria-hidden="true">14.3.1.</strong> CPU 的工作状态</a></li><li class="chapter-item expanded "><a href="../linux/03-cpu-1.html"><strong aria-hidden="true">14.3.2.</strong> CPU 上下文切换</a></li><li class="chapter-item expanded "><a href="../linux/cpu-usage-analysis.html"><strong aria-hidden="true">14.3.3.</strong> CPU 的使用情况</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/memory.html"><strong aria-hidden="true">14.4.</strong> 理解内存</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/memory-manage.html"><strong aria-hidden="true">14.4.1.</strong> 内存管理</a></li><li class="chapter-item expanded "><a href="../linux/memory-cache.html"><strong aria-hidden="true">14.4.2.</strong> 内存缓存</a></li><li class="chapter-item expanded "><a href="../linux/memory-stat.html"><strong aria-hidden="true">14.4.3.</strong> 内存状态</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/interrupt.html"><strong aria-hidden="true">14.5.</strong> 理解中断</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/sys-interrupt.html"><strong aria-hidden="true">14.5.1.</strong> 系统中断</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/02-process.html"><strong aria-hidden="true">14.6.</strong> 理解进程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/02-process-1.html"><strong aria-hidden="true">14.6.1.</strong> 进程的分类</a></li><li class="chapter-item expanded "><a href="../linux/02-process-2.html"><strong aria-hidden="true">14.6.2.</strong> 进程的状态</a></li><li class="chapter-item expanded "><a href="../linux/process-resouce.html"><strong aria-hidden="true">14.6.3.</strong> 进程占用的资源</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/01-filesystem.html"><strong aria-hidden="true">14.7.</strong> 理解文件系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/vfs.html"><strong aria-hidden="true">14.7.1.</strong> VFS</a></li><li class="chapter-item expanded "><a href="../linux/disk.html"><strong aria-hidden="true">14.7.2.</strong> 磁盘</a></li><li class="chapter-item expanded "><a href="../linux/filesystem-stat.html"><strong aria-hidden="true">14.7.3.</strong> 文件系统状态</a></li><li class="chapter-item expanded "><a href="../linux/02-io.html"><strong aria-hidden="true">14.7.4.</strong> I/O 操作分类</a></li><li class="chapter-item expanded "><a href="../linux/process_sys_io.html"><strong aria-hidden="true">14.7.5.</strong> 系统 I/O 状态</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/network.html"><strong aria-hidden="true">14.8.</strong> 理解网络</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/network-metrics.html"><strong aria-hidden="true">14.8.1.</strong> 性能指标与检测</a></li><li class="chapter-item expanded "><a href="../linux/network-nic-stat.html"><strong aria-hidden="true">14.8.2.</strong> 网卡状态</a></li><li class="chapter-item expanded "><a href="../linux/network-stat.html" class="active"><strong aria-hidden="true">14.8.3.</strong> 连接/协议栈状态</a></li><li class="chapter-item expanded "><a href="../linux/network-netfilter.html"><strong aria-hidden="true">14.8.4.</strong> 连接跟踪 netfilter</a></li><li class="chapter-item expanded "><a href="../linux/network-trace-pkt.html"><strong aria-hidden="true">14.8.5.</strong> 报文跟踪</a></li><li class="chapter-item expanded "><a href="../linux/network-dns-trace.html"><strong aria-hidden="true">14.8.6.</strong> DNS 解析追踪</a></li><li class="chapter-item expanded "><a href="../linux/netio-high-performance.html"><strong aria-hidden="true">14.8.7.</strong> 高性能网络 IO</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/04-tool.html"><strong aria-hidden="true">14.9.</strong> 分析工具</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/04-flame-graphs.html"><strong aria-hidden="true">14.9.1.</strong> 火焰图介绍</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/04-flame-graphs-cpu.html"><strong aria-hidden="true">14.9.1.1.</strong> CPU 火焰图</a></li><li class="chapter-item expanded "><a href="../linux/04-flame-graphs-memory.html"><strong aria-hidden="true">14.9.1.2.</strong> 内存火焰图</a></li><li class="chapter-item expanded "><a href="../linux/04-flame-graphs-off-cpu.html"><strong aria-hidden="true">14.9.1.3.</strong> Off-CPU 火焰图</a></li><li class="chapter-item expanded "><a href="../linux/04-flame-graphs-hot-code.html"><strong aria-hidden="true">14.9.1.4.</strong> 冷热火焰图</a></li><li class="chapter-item expanded "><a href="../linux/04-flame-graphs-differential.html"><strong aria-hidden="true">14.9.1.5.</strong> 差异火焰图</a></li><li class="chapter-item expanded "><a href="../linux/04-flame-generate.html"><strong aria-hidden="true">14.9.1.6.</strong> 火焰图生成</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/04-bcc-tools.html"><strong aria-hidden="true">14.9.2.</strong> BCC系列工具</a></li></ol></li><li class="chapter-item expanded "><a href="../linux/cpu-usage-high.html"><strong aria-hidden="true">14.10.</strong> 案例: CPU 使用率很高</a></li><li class="chapter-item expanded "><a href="../linux/todo.html"><strong aria-hidden="true">14.11.</strong> 待学习</a></li></ol></li><li class="chapter-item expanded "><a href="../mac/index.html"><strong aria-hidden="true">15.</strong> Mac 使用手册</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mac/soft.html"><strong aria-hidden="true">15.1.</strong> 常用软件</a></li><li class="chapter-item expanded "><a href="../mac/network.html"><strong aria-hidden="true">15.2.</strong> 系统操作</a></li></ol></li><li class="chapter-item expanded "><a href="../hyperledger/index.html"><strong aria-hidden="true">16.</strong> HyperLedger 超级账本</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../hyperledger/demo.html"><strong aria-hidden="true">16.1.</strong> Fabric 单机极简部署</a></li><li class="chapter-item expanded "><a href="../hyperledger/explorer.html"><strong aria-hidden="true">16.2.</strong> Fabric 浏览器安装</a></li><li class="chapter-item expanded "><a href="../hyperledger/plan.html"><strong aria-hidden="true">16.3.</strong> 后续安排...</a></li></ol></li></ol>
               <div style="width:100%;text-align:center">
                  <img style="width:100%" src="https://www.lijiaocn.com/img/ercode/cur.jpg"/>
               </div>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div style="text-align:center;width:100%">
                    <!--h1>顶部条幅广告</h1-->
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8176866190626448"
                     crossorigin="anonymous"></script>
                     <!-- 顶部条幅广告 -->
                    <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-8176866190626448"
                     data-ad-slot="1000173679"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                     <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                     </script>
                </div>

                <div id="content" class="content">
                    <main>
                        <!-- toc -->
<h1 id="linux的连接与协议栈状态的查看方法"><a class="header" href="#linux的连接与协议栈状态的查看方法">Linux的连接与协议栈状态的查看方法</a></h1>
<h2 id="netstat查看连接状态分布"><a class="header" href="#netstat查看连接状态分布">netstat查看连接状态分布</a></h2>
<p>用netstat查看连接状态的分布（用yum安装：yum install -y net-tools）：</p>
<pre><code class="language-sh">$ netstat -nat|awk '{print awk $NF}'|sort|uniq -c|sort -n
      1 CLOSE_WAIT
      1 FIN_WAIT2
      1 State
      1 established)
      3 LAST_ACK
     30 FIN_WAIT1
    151 LISTEN
    280 TIME_WAIT
   1548 ESTABLISHED
</code></pre>
<h2 id="查看本地临时端口占用情况"><a class="header" href="#查看本地临时端口占用情况">查看本地临时端口占用情况</a></h2>
<pre><code class="language-sh">$ netstat -ntp |grep &quot;11.0.110.0&quot;  |awk '{print $4}' |sort |uniq |wc
  18171   18171  308907
</code></pre>
<p>查看本地源端口范围：</p>
<pre><code class="language-sh">$ sysctl  net.ipv4.ip_local_port_range  
$ cat /proc/sys/net/ipv4/ip_local_port_range
</code></pre>
<p>设置本地源端口范围：</p>
<pre><code class="language-sh">sysctl -w net.ipv4.ip_local_port_range=&quot;1024 64000&quot;
</code></pre>
<p>临时端口不足时，Nginx会报下面的错误：</p>
<pre><code> (99: Cannot assign requested address) while connecting to upstream, client: 192.168.0.2, server: localhost, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;fastcgi://127.0.0.1:9000&quot;, host: &quot;192.168.0.30&quot;
</code></pre>
<h2 id="netstatss查看单个连接状态"><a class="header" href="#netstatss查看单个连接状态">netstat/ss查看单个连接状态</a></h2>
<p>用netstat查看详细连接，-t查看tcp连接，-u查看udp连接，-p显示对应进程：</p>
<pre><code class="language-sh">$ netstat -ntp
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 11.0.157.1:32888        11.0.157.6:8080         TIME_WAIT   -
tcp        0      0 11.0.157.1:45894        11.0.157.4:8080         TIME_WAIT   -
tcp        0      0 11.0.157.1:35826        11.0.157.9:8080         TIME_WAIT   -
tcp        0      0 11.0.157.1:57348        11.0.157.3:8080         TIME_WAIT   -
tcp        0      0 127.0.0.1:54728         127.0.0.1:10248         TIME_WAIT   -
</code></pre>
<p>ss命令是netstat的替代命令：</p>
<pre><code class="language-sh">$ ss -ntp
State      Recv-Q Send-Q     Local Address:Port         Peer Address:Port
ESTAB      0      0           10.19.180.92:10250        10.19.14.106:38292     users:((&quot;kubelet&quot;,pid=15242,fd=41))
ESTAB      0      0           10.19.180.92:35154        10.19.61.146:2379      users:((&quot;flanneld&quot;,pid=1042,fd=10))
ESTAB      0      0           10.19.180.92:45380        10.19.162.39:6443      users:((&quot;kube-proxy&quot;,pid=14013,fd=8))
</code></pre>
<p>当套接字是连接状态时，Established：</p>
<p><strong>Recv-Q</strong>：套接字接收队列中还没有被应用程序读取的字节数。</p>
<p><strong>Send-Q</strong>：套接字发送队列中还没有被远端主机确认的字节数。</p>
<p>当套接字是监听状态时，Listening，显示的半连接状态，即服务端收到客户端SYN，还没有完成三次握手的TCP连接：</p>
<p><strong>Recv-Q</strong>：TCP协议栈中的半连接队列长度的当前值，syn backlog当前值。</p>
<p><strong>Send-Q</strong>：TCP协议栈中的半连接队列长度的最大值，syn backlog最大值。</p>
<p>套接字是Established状态时，如果Recv-Q和Send-Q不为零，说明接收的数据无法被应用程序及时读取，以及应用的数据无法及时发送，是异常情况。</p>
<blockquote>
<p>问题：如果是UDP协议呢？Rece-Q和Send-Q的含义是什么？同Established。</p>
</blockquote>
<h2 id="netstat查看协议栈状态"><a class="header" href="#netstat查看协议栈状态">netstat查看协议栈状态</a></h2>
<p><code>netstat -s</code>打印出整个协议栈的状态，按照协议类型分开展示：</p>
<pre><code class="language-sh">$ netstat -s
Ip:
    3635473208 total packets received
    2855004908 forwarded
    0 incoming packets discarded
    769088666 incoming packets delivered
    3701098707 requests sent out
    44 dropped because of missing route
Icmp:
    100236 ICMP messages received
    0 input ICMP message failed.
    ICMP input histogram:
        destination unreachable: 995
        redirects: 4
        echo requests: 99229
        echo replies: 8
    114887 ICMP messages sent
    0 ICMP messages failed
    ICMP output histogram:
        destination unreachable: 15658
        echo replies: 99229
IcmpMsg:
        InType0: 8
        InType3: 995
        InType5: 4
        InType8: 99229
        OutType0: 99229
        OutType3: 15658
Tcp:
    3716853 active connections openings
    1228040 passive connection openings
    570 failed connection attempts
    610 connection resets received
    17 connections established
    33850465 segments received
    43122661 segments send out
    15575 segments retransmited
    4 bad segments received.
    1018 resets sent
Udp:
    735086502 packets received
    6 packets to unknown port received.
    33475 packet receive errors
    797838180 packets sent
    33475 receive buffer errors
    0 send buffer errors
UdpLite:
TcpExt:
    28250 invalid SYN cookies received
    3961 resets received for embryonic SYN_RECV sockets
    21371 packets pruned from receive queue because of socket buffer overrun
    72874448 TCP sockets finished time wait in fast timer
    1396 packets rejects in established connections because of timestamp
    6946924 delayed acks sent
    128318 delayed acks further delayed because of locked socket
    Quick ack mode was activated 49028 times
    1292037 packets directly queued to recvmsg prequeue.
    33405 bytes directly in process context from backlog
    566548477 bytes directly received in process context from prequeue
    420652665 packet headers predicted
    1255272 packets header predicted and directly queued to user
    285092354 acknowledgments not containing data payload received
...
</code></pre>
<h2 id="限制半开连接"><a class="header" href="#限制半开连接">限制半开连接</a></h2>
<p>半开连接最大数量：</p>
<pre><code class="language-sh">sysctl net.ipv4.tcp_max_syn_backlog
net.ipv4.tcp_max_syn_backlog = 256
</code></pre>
<p>限制半开连接建立速度：</p>
<pre><code class="language-sh"># 限制 syn 并发数为每秒 1 次
$ iptables -A INPUT -p tcp --syn -m limit --limit 1/s -j ACCEPT

# 限制单个 IP 在 60 秒新建立的连接数为 10
$ iptables -I INPUT -p tcp --dport 80 --syn -m recent --name SYN_FLOOD --update --seconds 60 --hitcount 10 -j REJECT
</code></pre>
<p>启动synccookie：</p>
<pre><code class="language-sh">sysctl -w net.ipv4.tcp_syncookies=1
net.ipv4.tcp_syncookies = 1
</code></pre>
<h2 id="参考"><a class="header" href="#参考">参考</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../linux/network-nic-stat.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../linux/network-netfilter.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
                <div style="text-align:center;width:100%">
                    <!--h1>底部相关广告</h1-->
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8176866190626448"
                         crossorigin="anonymous"></script>
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-format="autorelaxed"
                         data-ad-client="ca-pub-8176866190626448"
                         data-ad-slot="6443696990"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../linux/network-nic-stat.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../linux/network-netfilter.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
